<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Katalog DigiBooks</title>

<!-- Bootstrap & DataTables CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

<style>
  :root { --theme-bg: #f1f8e8; --accent: #4e73df; }
  body { background: var(--theme-bg); font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; padding: 20px; user-select: none; }
  .card { border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.07); }
  h1 { text-align:center; margin-bottom:10px; color:#222; user-select: none; }
  .table-container { overflow-x:auto; background:white; border-radius:12px; padding:16px; }
  th { background-color: var(--accent); color:#fff; text-align:center; }
  td { vertical-align: middle !important; }
  .top-row { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
  .badge-total { font-size:1rem; padding:10px 14px; border-radius:999px; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,0.06); }
  footer { text-align:center; margin-top:18px; color:#666; user-select: none; }
  @media (max-width:600px){ .top-row{ flex-direction:column; align-items:flex-start; } }
  .info-box {
    background: white;
    border-left: 5px solid var(--accent);
    padding: 14px 18px;
    margin-bottom: 18px;
    border-radius: 10px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.06);
    user-select: none;
  }
  .info-box h5 { margin-top: 0; color: var(--accent); font-weight: 600; }
  .info-links a {
    display: inline-block;
    margin-right: 8px;
    margin-top: 6px;
    text-decoration: none;
    background: var(--accent);
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    transition: 0.2s;
  }
  .info-links a:hover { background: #3c5fd7; }
  .no-data { text-align:center; padding:30px 0; color:#666; }
</style>
</head>

<body oncontextmenu="return false;" ondragstart="return false;" onselectstart="return false;">
  <div class="container">
    <h1>üìö Katalog DigiBooks</h1>

    <!-- BAGIAN INFORMASI ORDER & REQUEST -->
    <div class="info-box">
      <h5>‚ÑπÔ∏è Informasi Pemesanan & Request eBook</h5>
      <p>
        üí¨ <strong>Order eBook:</strong>
        <a href="https://wa.me/628984788152?text=Halo%20saya%20ingin%20order%20ebook" target="_blank">Klik di sini untuk memesan eBook</a>
      </p>
      <p><strong>Mau Request eBook?</strong></p>
      <div class="info-links">
        <a href="https://forms.gle/hmTDZX27jpoKYhjK7" target="_blank">Ebook Bhs. Indonesia</a>
        <a href="https://forms.gle/KX8Ujs1aQnuYwmAn9" target="_blank">Ebook Bhs. Inggris</a>
      </div>
    </div>

    <div class="card p-3">
      <div class="top-row mb-2">
        <div class="badge-total"><strong>Total Koleksi:</strong> <span id="totalCount">0</span> item</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <input id="globalSearch" class="form-control allow-input" placeholder="üîç Cari seluruh tabel..." style="min-width:240px;">
        </div>
      </div>

      <div class="table-container" id="tableWrap">
        <table id="katalog" class="table table-striped table-bordered" style="width:100%; display:none;">
          <thead id="tableHead"></thead>
          <tbody></tbody>
        </table>
        <div id="noDataMsg" class="no-data">Mohon ditunggu. File <code>Katalog</code> sedang dimuat.</div>
      </div>

      <footer>
        <p>¬© 2025 DigiBooks - Katalog eBook Indonesia</p>
      </footer>
    </div>
  </div>

  <!-- JS libs -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

  <script>
  /******************************************
   * File ini otomatis memuat data dari katalog.json
   ******************************************/
  fetch('katalog.json', { cache: "no-store" })
    .then(r => r.json())
    .then(json => initTable(json))
    .catch(err => console.error('Gagal memuat katalog.json:', err));

  function initTable(dataset) {
    if (!Array.isArray(dataset) || dataset.length === 0) {
      document.getElementById('noDataMsg').style.display = 'block';
      return;
    }

    document.getElementById('noDataMsg').style.display = 'none';
    const tableEl = document.getElementById('katalog');
    tableEl.style.display = 'table';

    const allKeys = Array.from(dataset.reduce((s, obj) => { Object.keys(obj).forEach(k => s.add(k)); return s; }, new Set()));
    const thead = document.getElementById('tableHead');

    const headerRow = document.createElement('tr');
    allKeys.forEach(k => {
      const th = document.createElement('th');
      th.textContent = k;
      headerRow.appendChild(th);
    });

    const filterRow = document.createElement('tr');
    filterRow.id = 'filterRow';
    allKeys.forEach(_ => {
      const th = document.createElement('th');
      th.innerHTML = '<select class="form-select form-select-sm column-filter"><option value="">Semua</option></select>';
      filterRow.appendChild(th);
    });

    thead.innerHTML = '';
    thead.appendChild(headerRow);
    thead.appendChild(filterRow);

    const columns = allKeys.map(k => ({ data: k }));

    const table = $('#katalog').DataTable({
      data: dataset,
      columns: columns,
      responsive: true,
      pageLength: 15,
      dom: 'lrtip',
      language: {
        search: "üîç Cari:",
        lengthMenu: "Tampilkan _MENU_ entri per halaman",
        info: "Menampilkan _START_ - _END_ dari _TOTAL_ data",
        paginate: { previous: "Sebelumnya", next: "Berikutnya" },
        zeroRecords: "Tidak ditemukan hasil yang cocok"
      },
      createdRow: function(row, data, dataIndex) {
        $('td', row).attr('oncopy', 'return false;');
      }
    });

    document.getElementById('totalCount').textContent = dataset.length;

    // Aktifkan copy hanya untuk kolom "Kode Order"
    const orderColIndex = allKeys.findIndex(k => k.toLowerCase().includes('kode order'));
    if (orderColIndex >= 0) {
      $('#katalog tbody td:nth-child('+(orderColIndex+1)+')').attr('oncopy','return true;');
    }

    table.columns().every(function(index) {
      const column = this;
      const select = $('#filterRow').find('select').eq(index);
      const values = new Set();
      column.data().each(function(d) { values.add(d); });
      Array.from(values).sort().forEach(function(v) {
        if (v !== null && v !== undefined && String(v).trim() !== '') {
          select.append($('<option>').val(v).text(v));
        }
      });
      select.on('change', function() {
        const val = $.fn.dataTable.util.escapeRegex($(this).val());
        column.search(val ? '^'+val+'$' : '', true, false).draw();
      });
    });

    $('#globalSearch').on('keyup change', function() {
      table.search(this.value).draw();
    });
  }

  // IZINKAN INPUT DI SEARCH BAR
  document.addEventListener('keydown', function(e) {
    const active = document.activeElement;
    if (active && active.classList.contains('allow-input')) {
      e.stopPropagation();
      return true;
    }
    // Blok kombinasi Ctrl+S, Ctrl+U, Ctrl+C, F12
    if (e.ctrlKey && ['s','u','c'].includes(e.key.toLowerCase())) e.preventDefault();
    if (e.key === 'F12') e.preventDefault();
  }, true);
  </script>
</body>
</html>
